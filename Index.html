<!DOCTYPE html>
<html>
    <head>        
        
  <!-- CI Journeys Web Tracking Script -->

        <script>
                (function (a, t, i) { var e = "MSCI"; var s = "Analytics"; var o = e + "queue"; a[o] = a[o] || []; var r = a[e] || function (n) { var t = {}; t[s] = {}; function e(e) { while (e.length) { var r = e.pop(); t[s][r] = function (e) { return function () { a[o].push([e, n, arguments]) } }(r) } } var r = "track"; var i = "set"; e([r + "Event", r + "View", r + "Action", i + "Config", i + "Property", i + "User", "initialize", "teardown"]); return t }(i.name); var n = i.name; if (!a[e]) { a[n] = r[s]; a[o].push(["new", n]); setTimeout(function () { var e = "script"; var r = t.createElement(e); r.async = 1; r.src = i.src; var n = t.getElementsByTagName(e)[0]; n.parentNode.insertBefore(r, n) }, 1) } else { a[n] = new r[s] } if (i.user) { a[n].setUser(i.user) } if (i.props) { for (var c in i.props) { a[n].setProperty(c, i.props[c]) } } a[n].initialize(i.cfg) })(window, document, {

                    src: "https://cxppusa1rdrect01sa02cdn-endpoint.azureedge.net/webtracking/WebTracking/WebTracking.bundle.js",
                    name: "MSCI",
                    cfg: {

                        ingestionKey: "eb5611e8b6b649d994c755dd862b6e54-f632e5cb-395b-4455-bed8-d8df431a9b0a-7447",
                        endpointUrl: "https://mobile.events.data.microsoft.com/OneCollector/1.0/",
                        autoCapture: {
                            view: true,
                            click: true
                        },
                        orgInfo: {
                            orgId: "22d0e406-f60c-4b03-b846-4d0aaf81a1ab",
                            orgTenantId: "d441ad83-6235-46d6-ab1a-89744a91b1d8",
                            orgGeo: "USA"
                        }
                    }
                });
        </script>

  <!-- CI Journeys Web Tracking Script -->
        
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
         <title>CI Journeys Form Test</title>
        <meta name="referrer" content="never">
        <meta type="xrm/designer/setting" name="type" value="marketing-designer-content-editor-document">
        <meta type="xrm/designer/setting" name="layout-editable" value="marketing-designer-layout-editable">
    </head>
    <body>
<form id="form1">
<input name="firstname" type="text" placeholder="First Name" required>
<input name="lastname" type="text" placeholder="Last Name" required>
<input name="emailaddress1" type="email" placeholder="Email Address" required>
<input name="telephone1" type="tel" placeholder="Phone Number">
<input name="address1_line1" type="text" placeholder="Street 1">
<input name="chr_webformcompanyname" type="text" placeholder="Company Name">
<input name="address1_country" type="text" placeholder="Country">
<input name="testfield" type="text" placeholder="Text Field">
<!-- <input type="checkbox" id="chkOptin" name="chkOptin" value="false"> -->
<!--<a href="https://cijpocstorage.blob.core.windows.net/$web/non-form.html" target="_blank">https://cijpocstorage.blob.core.windows.net/$web/non-form.html</a> -->
<label for="chkOptin">Opt in to blogs</label>
<button type="submit">Submit</button>
</form>
  <h1>CI Journeys Tracking + Form Test</h1>

  <!-- CI Journeys Form Embed -->

<script src='https://cxppusa1formui01cdnsa01-endpoint.azureedge.net/usa/FormCapture/FormCapture.bundle.js'></script>
<script>
    // NOTE: for reference see https://go.microsoft.com/fwlink/?linkid=2250770

    d365mktformcapture.waitForElement("***Please fill***") // example: "#form1" as a selector for form with id="form1"
    .then(form => {
        const mappings = [
            {
                FormFieldName: "***Please fill***",
                DataverseFieldName: "firstname",
            },
            {
                FormFieldName: "***Please fill***",
                DataverseFieldName: "lastname",
            },
            {
                FormFieldName: "***Please fill***",
                DataverseFieldName: "emailaddress1",
            },
            {
                FormFieldName: "***Please fill***",
                DataverseFieldName: "telephone1",
            },
            {
                DataverseFieldName: "chr_countryid",
                DataverseFieldValue: "{\"Id\":\"***Please fill***\",\"LogicalName\":\"chr_statecountry\"}",
            },
            {
                FormFieldName: "***Please fill***",
                DataverseFieldName: "msdynmkt_topicid;channels;optinwhenchecked",
                DataverseFieldValue: "3de23440-47a8-f011-bbd3-000d3a32f9c7;Email,Text;true",
            },

        ];

        form.addEventListener("submit", (e) => {
            debugger;
             e.preventDefault();
            const serializedForm = d365mktformcapture.serializeForm(form, mappings);
            // console.log(JSON.stringify(serializedForm)); // NOTE: enable for debugging
            const payload = serializedForm.SerializedForm.build();

            const captureConfig = {
                FormId: "4a5f845f-9fda-f011-8544-000d3a32f9c7",
                FormApiUrl: "https://public-usa.mkt.dynamics.com/api/v1.0/orgs/22d0e406-f60c-4b03-b846-4d0aaf81a1ab/landingpageforms"
            }
            d365mktformcapture.submitForm(captureConfig, payload);
        }, true);
    });
</script>


 <!-- CI Journeys Form Embed -->  
  
</body>
</html>
